import { MLProduct } from '@/types';

export const mockProducts: MLProduct[] = [
  // iPhones
  {
    id: 'MLM001',
    title: 'iPhone 15 Pro Max 256GB Titanio Natural',
    price: 28999,
    currency_id: 'MXN',
    thumbnail: 'https://fdn2.gsmarena.com/vv/bigpic/apple-iphone-15-pro-max.jpg',
    condition: 'new',
    permalink: 'https://www.mercadolibre.com.mx/iphone-15-pro-max',
    seller: {
      id: 123456,
      nickname: 'Apple Store Oficial',
    },
    shipping: {
      free_shipping: true,
    },
    original_price: 32999,
    available_quantity: 50,
    sold_quantity: 245,
  },
  {
    id: 'MLM002',
    title: 'iPhone 15 128GB Azul',
    price: 19999,
    currency_id: 'MXN',
    thumbnail: 'https://fdn2.gsmarena.com/vv/bigpic/apple-iphone-15.jpg',
    condition: 'new',
    permalink: 'https://www.mercadolibre.com.mx/iphone-15',
    seller: {
      id: 123456,
      nickname: 'Apple Store Oficial',
    },
    shipping: {
      free_shipping: true,
    },
    original_price: 22999,
    available_quantity: 100,
    sold_quantity: 567,
  },
  {
    id: 'MLM003',
    title: 'iPhone 14 Plus 256GB Morado',
    price: 18499,
    currency_id: 'MXN',
    thumbnail: 'https://fdn2.gsmarena.com/vv/bigpic/apple-iphone-14-plus.jpg',
    condition: 'new',
    permalink: 'https://www.mercadolibre.com.mx/iphone-14-plus',
    seller: {
      id: 123456,
      nickname: 'Apple Store Oficial',
    },
    shipping: {
      free_shipping: true,
    },
    original_price: 21999,
    available_quantity: 75,
    sold_quantity: 432,
  },
  {
    id: 'MLM004',
    title: 'iPhone 13 128GB Starlight',
    price: 14999,
    currency_id: 'MXN',
    thumbnail: 'https://fdn2.gsmarena.com/vv/bigpic/apple-iphone-13.jpg',
    condition: 'new',
    permalink: 'https://www.mercadolibre.com.mx/iphone-13',
    seller: {
      id: 123456,
      nickname: 'Apple Store Oficial',
    },
    shipping: {
      free_shipping: true,
    },
    original_price: 17999,
    available_quantity: 120,
    sold_quantity: 891,
  },
  {
    id: 'MLM005',
    title: 'iPhone 15 Pro 256GB Titanio Negro',
    price: 26499,
    currency_id: 'MXN',
    thumbnail: 'https://fdn2.gsmarena.com/vv/bigpic/apple-iphone-15-pro.jpg',
    condition: 'new',
    permalink: 'https://www.mercadolibre.com.mx/iphone-15-pro',
    seller: {
      id: 123456,
      nickname: 'Apple Store Oficial',
    },
    shipping: {
      free_shipping: true,
    },
    original_price: 29999,
    available_quantity: 60,
    sold_quantity: 334,
  },
  {
    id: 'MLM006',
    title: 'iPhone SE (3ra generación) 128GB Negro',
    price: 11999,
    currency_id: 'MXN',
    thumbnail: 'https://fdn2.gsmarena.com/vv/bigpic/apple-iphone-se-2022.jpg',
    condition: 'new',
    permalink: 'https://www.mercadolibre.com.mx/iphone-se',
    seller: {
      id: 123456,
      nickname: 'Apple Store Oficial',
    },
    shipping: {
      free_shipping: true,
    },
    available_quantity: 200,
    sold_quantity: 678,
  },

  // Android - Samsung
  {
    id: 'MLM101',
    title: 'Samsung Galaxy S24 Ultra 256GB Titanio Gris',
    price: 27999,
    currency_id: 'MXN',
    thumbnail: 'https://fdn2.gsmarena.com/vv/bigpic/samsung-galaxy-s24-ultra-5g-sm-s928-stylus.jpg',
    condition: 'new',
    permalink: 'https://www.mercadolibre.com.mx/samsung-s24-ultra',
    seller: {
      id: 234567,
      nickname: 'Samsung Official Store',
    },
    shipping: {
      free_shipping: true,
    },
    original_price: 31999,
    available_quantity: 80,
    sold_quantity: 289,
  },
  {
    id: 'MLM102',
    title: 'Samsung Galaxy S23 256GB Verde',
    price: 16999,
    currency_id: 'MXN',
    thumbnail: 'https://fdn2.gsmarena.com/vv/bigpic/samsung-galaxy-s23-5g.jpg',
    condition: 'new',
    permalink: 'https://www.mercadolibre.com.mx/samsung-s23',
    seller: {
      id: 234567,
      nickname: 'Samsung Official Store',
    },
    shipping: {
      free_shipping: true,
    },
    original_price: 19999,
    available_quantity: 150,
    sold_quantity: 456,
  },
  {
    id: 'MLM103',
    title: 'Samsung Galaxy A54 5G 256GB Negro',
    price: 8999,
    currency_id: 'MXN',
    thumbnail: 'https://fdn2.gsmarena.com/vv/bigpic/samsung-galaxy-a54.jpg',
    condition: 'new',
    permalink: 'https://www.mercadolibre.com.mx/samsung-a54',
    seller: {
      id: 234567,
      nickname: 'Samsung Official Store',
    },
    shipping: {
      free_shipping: true,
    },
    original_price: 10999,
    available_quantity: 250,
    sold_quantity: 723,
  },
  {
    id: 'MLM104',
    title: 'Samsung Galaxy Z Fold5 512GB Phantom Black',
    price: 39999,
    currency_id: 'MXN',
    thumbnail: 'https://fdn2.gsmarena.com/vv/bigpic/samsung-galaxy-z-fold5.jpg',
    condition: 'new',
    permalink: 'https://www.mercadolibre.com.mx/samsung-z-fold5',
    seller: {
      id: 234567,
      nickname: 'Samsung Official Store',
    },
    shipping: {
      free_shipping: true,
    },
    original_price: 44999,
    available_quantity: 30,
    sold_quantity: 124,
  },

  // Android - Google Pixel
  {
    id: 'MLM201',
    title: 'Google Pixel 8 Pro 256GB Obsidian',
    price: 22999,
    currency_id: 'MXN',
    thumbnail: 'https://fdn2.gsmarena.com/vv/bigpic/google-pixel-8-pro.jpg',
    condition: 'new',
    permalink: 'https://www.mercadolibre.com.mx/pixel-8-pro',
    seller: {
      id: 345678,
      nickname: 'Google Store MX',
    },
    shipping: {
      free_shipping: true,
    },
    original_price: 25999,
    available_quantity: 60,
    sold_quantity: 198,
  },
  {
    id: 'MLM202',
    title: 'Google Pixel 8 128GB Hazel',
    price: 17999,
    currency_id: 'MXN',
    thumbnail: 'https://fdn2.gsmarena.com/vv/bigpic/google-pixel-8.jpg',
    condition: 'new',
    permalink: 'https://www.mercadolibre.com.mx/pixel-8',
    seller: {
      id: 345678,
      nickname: 'Google Store MX',
    },
    shipping: {
      free_shipping: true,
    },
    original_price: 20999,
    available_quantity: 90,
    sold_quantity: 345,
  },

  // Android - Xiaomi
  {
    id: 'MLM301',
    title: 'Xiaomi 13 Pro 256GB Negro',
    price: 15999,
    currency_id: 'MXN',
    thumbnail: 'https://fdn2.gsmarena.com/vv/bigpic/xiaomi-13-pro-black.jpg',
    condition: 'new',
    permalink: 'https://www.mercadolibre.com.mx/xiaomi-13-pro',
    seller: {
      id: 456789,
      nickname: 'Xiaomi Store Oficial',
    },
    shipping: {
      free_shipping: true,
    },
    original_price: 18999,
    available_quantity: 120,
    sold_quantity: 567,
  },
  {
    id: 'MLM302',
    title: 'Xiaomi Redmi Note 13 Pro 256GB Azul',
    price: 6999,
    currency_id: 'MXN',
    thumbnail: 'https://fdn2.gsmarena.com/vv/bigpic/xiaomi-redmi-note-13-pro-5g.jpg',
    condition: 'new',
    permalink: 'https://www.mercadolibre.com.mx/redmi-note-13-pro',
    seller: {
      id: 456789,
      nickname: 'Xiaomi Store Oficial',
    },
    shipping: {
      free_shipping: true,
    },
    original_price: 8999,
    available_quantity: 300,
    sold_quantity: 892,
  },

  // Android - Motorola
  {
    id: 'MLM401',
    title: 'Motorola Edge 40 Pro 256GB Interstellar Black',
    price: 13999,
    currency_id: 'MXN',
    thumbnail: 'https://fdn2.gsmarena.com/vv/bigpic/motorola-edge-40-pro.jpg',
    condition: 'new',
    permalink: 'https://www.mercadolibre.com.mx/moto-edge-40-pro',
    seller: {
      id: 567890,
      nickname: 'Motorola Oficial',
    },
    shipping: {
      free_shipping: true,
    },
    original_price: 16999,
    available_quantity: 85,
    sold_quantity: 234,
  },
  {
    id: 'MLM402',
    title: 'Motorola Moto G84 5G 256GB Azul',
    price: 5999,
    currency_id: 'MXN',
    thumbnail: 'https://fdn2.gsmarena.com/vv/bigpic/motorola-moto-g84.jpg',
    condition: 'new',
    permalink: 'https://www.mercadolibre.com.mx/moto-g84',
    seller: {
      id: 567890,
      nickname: 'Motorola Oficial',
    },
    shipping: {
      free_shipping: true,
    },
    original_price: 7999,
    available_quantity: 180,
    sold_quantity: 645,
  },
];

// Función para buscar productos por término
export function searchMockProducts(query: string, limit: number = 20): MLProduct[] {
  const lowerQuery = query.toLowerCase();

  // Detectar búsqueda por precio
  const pricePatterns = [
    /precio similar/i,
    /parecido al/i,
    /similar al/i,
    /rango de precio/i,
    /más barato que/i,
    /más caro que/i,
    /entre.*y.*pesos/i,
    /menos de.*pesos/i,
    /más de.*pesos/i,
    /alrededor de.*pesos/i,
  ];

  const isPriceSearch = pricePatterns.some(pattern => pattern.test(query));

  if (isPriceSearch) {
    // Buscar el producto mencionado en la consulta
    const brands = ['iphone', 'samsung', 'galaxy', 'pixel', 'xiaomi', 'motorola', 'moto', 'redmi'];
    let referenceProduct: MLProduct | undefined;

    for (const brand of brands) {
      if (lowerQuery.includes(brand)) {
        referenceProduct = mockProducts.find(p =>
          p.title.toLowerCase().includes(brand)
        );
        if (referenceProduct) break;
      }
    }

    if (referenceProduct) {
      // Buscar productos con precio similar (± 30%)
      const minPrice = referenceProduct.price * 0.7;
      const maxPrice = referenceProduct.price * 1.3;

      const filtered = mockProducts.filter(product =>
        product.price >= minPrice &&
        product.price <= maxPrice &&
        product.id !== referenceProduct.id // Excluir el producto de referencia
      ).sort((a, b) => {
        // Ordenar por cercanía al precio de referencia
        const diffA = Math.abs(a.price - referenceProduct.price);
        const diffB = Math.abs(b.price - referenceProduct.price);
        return diffA - diffB;
      });

      return filtered.slice(0, limit);
    }

    // Si menciona un rango específico de precio
    // Primero normalizar "mil" y "k" a números
    const normalizedQuery = query
      .replace(/(\d+)\s*mil/gi, (match, num) => String(parseInt(num) * 1000))
      .replace(/(\d+)\s*k/gi, (match, num) => String(parseInt(num) * 1000));

    const rangeMatch = normalizedQuery.match(/(\d+).*(?:y|a).*(\d+)/);
    if (rangeMatch) {
      const minPrice = parseInt(rangeMatch[1]);
      const maxPrice = parseInt(rangeMatch[2]);
      const filtered = mockProducts.filter(product =>
        product.price >= minPrice && product.price <= maxPrice
      );
      return filtered.slice(0, limit);
    }

    // Si menciona "menos de X pesos" o "hasta X" o "máximo X"
    const lessPatterns = [
      /menos de\s+(\d+)/,
      /hasta\s+(\d+)/,
      /máximo\s+(\d+)/,
      /de\s+(\d+)\s+(?:pesos?\s+)?o\s+menos/,
      /no\s+más\s+de\s+(\d+)/,
    ];

    for (const pattern of lessPatterns) {
      const match = normalizedQuery.match(pattern);
      if (match) {
        const maxPrice = parseInt(match[1]);
        const filtered = mockProducts.filter(product => product.price <= maxPrice);
        return filtered.slice(0, limit);
      }
    }

    // Si menciona "más de X pesos" o "desde X" o "a partir de X" o "mínimo X"
    const morePatterns = [
      /más de\s+(\d+)/,
      /de\s+(\d+)\s+(?:pesos?\s+)?o\s+más/,
      /desde\s+(\d+)/,
      /a\s+partir\s+de\s+(\d+)/,
      /mínimo\s+(\d+)/,
      /arriba\s+de\s+(\d+)/,
    ];

    for (const pattern of morePatterns) {
      const match = normalizedQuery.match(pattern);
      if (match) {
        const minPrice = parseInt(match[1]);
        const filtered = mockProducts.filter(product => product.price >= minPrice);
        return filtered.slice(0, limit);
      }
    }
  }

  // Búsqueda normal por texto en el título
  const filtered = mockProducts.filter(product =>
    product.title.toLowerCase().includes(lowerQuery)
  );

  return filtered.slice(0, limit);
}

// Función para obtener productos aleatorios
export function getFeaturedMockProducts(limit: number = 12): MLProduct[] {
  const shuffled = [...mockProducts].sort(() => 0.5 - Math.random());
  return shuffled.slice(0, limit);
}
